<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>母の日メッセージ</title>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #FFF3E0; /* 奶黃色背景 */
      font-family: 'M PLUS Rounded 1c', sans-serif; /* 使用圓潤的日文字體 */
      position: relative;
      min-height: 100vh;
      overflow: auto; /* 允許頁面滾動 */
    }
    body::before {
      content: '';
      position: fixed; /* 使用 fixed 確保背景不隨滾動移動 */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        /* 粉紅色小圓點 */
        radial-gradient(circle, #FFB6C1 2px, transparent 2px) 0 0 / 50px 50px,
        /* 藍色小圓點 */
        radial-gradient(circle, #ADD8E6 2px, transparent 2px) 25px 25px / 50px 50px,
        /* 白色小圓點 */
        radial-gradient(circle, #FFFFFF 2px, transparent 2px) 12.5px 37.5px / 50px 50px;
      opacity: 0.5; /* 透明度降低，避免過於顯眼 */
      z-index: -1;
    }
    .header {
      background-color: #FFE4E1; /* 柔和粉色 */
      padding: 1rem 2rem; /* 上下窄一點（1rem），左右保持 2rem */
      text-align: center;
      position: relative;
      display: flex; /* 使用 Flexbox 水平排列 */
      align-items: center; /* 垂直居中對齊 */
      justify-content: center; /* 水平居中 */
      gap: 5rem; /* 圖片與標題之間的間距 */
      width: 100%;
      max-width: 1000px; /* 與 form-container 相同 */
      min-width: 900px; /* 與 form-container 相同 */
      margin: 0 auto; /* 居中 */
      box-sizing: border-box; /* 確保邊框不影響寬度計算 */
      border: 2px dashed #D4A5D4; /* 紫色虛線邊框 */
      border-radius: 1rem; /* 圓角 */
    }
    .divider {
      width: 100%;
      max-width: 1000px; /* 與 header 和 form-container 相同 */
      min-width: 900px; /* 與 header 和 form-container 相同 */
      height: 3px; /* 虛線高度 */
      margin: 1rem auto; /* 上下間距，居中 */
      background: repeating-linear-gradient(
        90deg,
        #ADD8E6 0px, /* 淺藍 */
        #ADD8E6 8px,
        transparent 8px,
        transparent 16px,
        #FFFFFF 16px, /* 白色 */
        #FFFFFF 24px,
        transparent 24px,
        transparent 32px,
        #FFB6C1 32px, /* 粉紅 */
        #FFB6C1 40px,
        transparent 40px,
        transparent 48px
      ); /* 三色點狀虛線，水平方向 */
    }
    .form-container {
      background-color: #E0FFFF; /* 淺藍色背景 */
      padding: 1rem; /* 縮小邊界 */
      border-radius: 1rem;
      border: 2px dashed #D4A5D4; /* 紫色虛線邊框 */
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 1000px; /* 最大寬度 */
      min-width: 900px; /* 最小寬度，確保能容納 custom-table */
      margin: 2rem auto;
      position: relative;
      box-sizing: border-box; /* 確保邊框不影響寬度計算 */
    }
    .form-container::before {
      content: '';
      position: absolute;
      top: -30px;
      left: -20px;
      width: 60px;
      height: 60px;
      background: url('daikon.png') no-repeat center;
      background-size: contain;
      transform: rotate(-30deg); /* 旋轉圖片，模擬插在框上的感覺 */
      z-index: 1;
    }
    .custom-table {
      position: relative;
      border-radius: 0.5rem;
      overflow: hidden;
      min-width: 900px; /* 保持最小寬度 */
      background-color: #E0FFFF; /* 淺藍色背景 */
      padding: 1rem;
      width: 100%; /* 適應 form-container 的寬度 */
      box-sizing: border-box; /* 確保邊框和內距不影響寬度計算 */
    }
    .custom-table::before {
      content: '';
      position: absolute;
      top: -6px;
      left: -6px;
      right: -6px;
      bottom: -6px;
      border: 3px solid transparent;
      border-radius: 0.75rem;
      background: repeating-linear-gradient(
        135deg, /* 135 度，與 header 的 90 度區別 */
        #ADD8E6 0px, /* 淺藍 */
        #ADD8E6 10px, /* 加大間距 */
        transparent 10px,
        transparent 20px,
        #FFFFFF 20px, /* 白色 */
        #FFFFFF 30px,
        transparent 30px,
        transparent 40px,
        #FFB6C1 40px, /* 粉紅 */
        #FFB6C1 50px,
        transparent 50px,
        transparent 60px
      ); /* 表格邊框的三色虛線 */
      z-index: -1;
    }
    .custom-table .table-container {
      position: relative;
      padding: 0.5rem;
      border-radius: 0.5rem;
      background: linear-gradient(to bottom, #FCE4EC, #E0BBE4); /* 粉色到紫色的漸層背景 */
    }
    .custom-table .table-container::before {
      content: '✨';
      position: absolute;
      top: -0.5rem;
      left: -0.5rem;
      color: #FFDAB9;
      font-size: 1.2rem;
    }
    .custom-table .table-container::after {
      content: '✨';
      position: absolute;
      bottom: -0.5rem;
      right: -0.5rem;
      color: #FFDAB9;
      font-size: 1.2rem;
    }
    .custom-table .table-row {
      display: flex;
      flex-direction: column; /* 改為垂直排列，顯示單列 */
      border: 2px solid #E0BBE4; /* 粉紫色外邊框 */
      border-radius: 0.3rem;
      padding: 0.5rem;
      margin-bottom: 0.5rem; /* 行之間的間距 */
    }
    .custom-table .table-cell {
      padding: 0.5rem;
      text-align: left; /* 文字靠左對齊 */
      color: #555;
      overflow-wrap: break-word; /* 自動換行 */
      white-space: pre-line; /* 支援 \n 換行顯示 */
      line-height: 1.5; /* 增加行距，使換行更清晰 */
      border-bottom: 1px dashed #FF9999; /* 粉色虛線內邊框 */
    }
    .custom-table .table-cell:last-child {
      border-bottom: none; /* 最後一個單元格移除底邊框 */
    }
    .custom-table .nav-arrows {
      display: flex;
      justify-content: space-between;
      margin: 1rem 0; /* 上下間距 */
      position: relative; /* 為動畫圖案提供定位上下文 */
    }
    .custom-table .nav-arrow {
      background-color: #FFE4E1; /* 柔和粉色 */
      color: #FF9999; /* 粉色文字 */
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 1.2rem;
      transition: background-color 0.3s;
      position: relative;
      z-index: 1; /* 確保按鈕在圖案上方 */
    }
    .custom-table .nav-arrow:hover {
      background-color: #FFDAB9; /* 懸停時變為淺橙色 */
    }
    .custom-table .nav-arrow.disabled {
      background-color: #E5E7EB; /* 禁用時為灰色 */
      color: #9CA3AF;
      cursor: not-allowed;
    }
    /* 圖案動畫樣式 */
    .arrow-animation {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 150px; /* 圖片寬度 */
      height: 150px; /* 圖片高度 */
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0; /* 初始隱藏 */
      z-index: 0; /* 確保圖案在按鈕下方 */
      pointer-events: none; /* 避免圖案影響按鈕點擊 */
    }
    .move-left-to-right {
      animation: moveLeftToRight 2s ease-in-out forwards;
    }
    .move-right-to-left {
      animation: moveRightToLeft 2s ease-in-out forwards;
    }
    @keyframes moveLeftToRight {
      0% {
        left: -200px; /* 從左邊外側開始（圖片寬度） */
        opacity: 0; /* 淡入開始 */
      }
      10% {
        opacity: 1; /* 淡入完成 */
      }
      90% {
        opacity: 1; /* 保持可見 */
      }
      100% {
        left: calc(100% + 200px); /* 移動到右邊外側（圖片寬度） */
        opacity: 0; /* 淡出完成 */
      }
    }
    @keyframes moveRightToLeft {
      0% {
        right: -200px; /* 從右邊外側開始（圖片寬度） */
        opacity: 0; /* 淡入開始 */
      }
      10% {
        opacity: 1; /* 淡入完成 */
      }
      90% {
        opacity: 1; /* 保持可見 */
      }
      100% {
        right: calc(100% + 200px); /* 移動到左邊外側（圖片寬度） */
        opacity: 0; /* 淡出完成 */
      }
    }
    .header-image {
      width: 200px; /* 調整寬度 */
      height: 113px; /* 根據長寬比計算高度 */
      object-fit: contain; /* 保持圖片比例 */
      position: relative;
    }
    .header-image::before,
    .header-image::after {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      height: 1px;
      background: #FFDAB9; /* 使用與原邊框相同的顏色 */
    }
    .header-image::before {
      top: -3px; /* 模擬樂譜線，上方實線 */
    }
    .header-image::after {
      bottom: -3px; /* 模擬樂譜線，下方實線 */
    }
    /* 替代 Tailwind 的樣式 */
    .text-4xl {
      font-size: 2.25rem; /* 36px */
      line-height: 2.5rem;
    }
    .font-bold {
      font-weight: 700;
    }
    .text-lg {
      font-size: 1.125rem; /* 18px */
      line-height: 1.75rem;
    }
    .mt-2 {
      margin-top: 0.5rem; /* 8px */
    }
    .text-2xl {
      font-size: 1.5rem; /* 24px */
      line-height: 2rem;
    }
    .text-center {
      text-align: center;
    }
    .mb-4 {
      margin-bottom: 1rem; /* 16px */
    }
    h1 {
      color: #FF9999; /* 粉色標題 */
    }
    p {
      color: #555;
    }
    /* 可愛風格的標題 */
    .message-title {
      position: relative;
      display: inline-block;
      color: #FF9999; /* 粉色，提升可讀性 */
      text-shadow: 1px 1px 2px #D4E4FA; /* 淺藍色陰影 */
      padding: 0 1rem;
      background: linear-gradient(to right, #FFF5F7, #FFE4E1); /* 更柔和的粉色漸層 */
      border-radius: 0.5rem;
      margin-bottom: 1rem;
    }
    .message-title::before {
      content: '✨'; /* 星星裝飾 */
      position: absolute;
      left: -1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #FFDAB9;
      font-size: 1.2rem;
    }
    .message-title::after {
      content: '✨';
      position: absolute;
      right: -1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #FFDAB9;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="乙夏れいファンLOGO.png" 
         alt="愛你Fan's! 画像" 
         class="header-image">
    <div>
      <h1 class="text-4xl font-bold">母の日おめでとう！</h1>
      <p class="text-lg mt-2">れいちゃんへの感謝のメッセージを残して、愛と感謝を伝えましょう！</p>
    </div>
  </div>

  <div class="divider"></div> <!-- 新增的三色虛線分隔線 -->

  <div class="form-container">
    <h2 class="text-2xl font-bold text-center mb-4 message-title">れいちゃんへのメッセージ</h2>
    <div class="custom-table">
      <div class="nav-arrows">
        <button class="nav-arrow" id="prev-arrow-top" disabled>← 前</button>
        <div class="arrow-animation" id="animation-top"></div> <!-- 動畫圖案 -->
        <button class="nav-arrow" id="next-arrow-top" disabled>次 →</button>
      </div>
      <div class="table-container" id="table-container">
        <p>読み込み中…</p> <!-- 加載提示 -->
      </div>
      <div class="nav-arrows">
        <button class="nav-arrow" id="prev-arrow-bottom" disabled>← 前</button>
        <div class="arrow-animation" id="animation-bottom"></div> <!-- 動畫圖案 -->
        <button class="nav-arrow" id="next-arrow-bottom" disabled>次 →</button>
      </div>
    </div>
  </div>

  <footer class="text-center py-4" style="background-color: #FFE4E1;">
    <p>© 2025 母の日イベント | すべての母親に愛と感謝を込めて</p>
  </footer>

  <script>
    // Apps Script Web 應用程式 URL
    const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbw0T26DPyiSfi3OlzjcLugVGbsFM-OcoOyG24KzGRQpOZl_wrhWnzNA_tdr0wTMISmtKw/exec';

    // 儲存表格數據和當前顯示的列索引
    let tableData = [];
    let currentRowIndex = 0;

    // 定義圖片陣列
    const leftToRightImages = [
      'reikal1.png', // 假設為 reikal1.png
      'ham_ham_hyper.gif', // 假設為 reikal2.png
      'Hamtaro.gif'  // 假設為 reikal3.png
    ];
    const rightToLeftImages = [
      'reikar1.png', // 假設為 reikar1.png
      'ham_ham_hyper.gif', // 假設為 reikar2.png
      'Hamtaro.gif'  // 假設為 reikar3.png
    ];

    // 隨機選擇圖片的函數
    function getRandomImage(images) {
      const randomIndex = Math.floor(Math.random() * images.length);
      return images[randomIndex];
    }

    // 獲取 DOM 元素
    const tableContainer = document.getElementById('table-container');
    const prevArrowTop = document.getElementById('prev-arrow-top');
    const nextArrowTop = document.getElementById('next-arrow-top');
    const prevArrowBottom = document.getElementById('prev-arrow-bottom');
    const nextArrowBottom = document.getElementById('next-arrow-bottom');
    const animationTop = document.getElementById('animation-top');
    const animationBottom = document.getElementById('animation-bottom');

    // 重置動畫圖案的樣式
    function resetAnimation(element) {
      element.style.left = '';
      element.style.right = '';
      element.style.opacity = '0';
      element.classList.remove('move-left-to-right', 'move-right-to-left');
    }

    // 為動畫元素添加 animationend 事件監聽器
    animationTop.addEventListener('animationend', () => {
      resetAnimation(animationTop);
    });
    animationBottom.addEventListener('animationend', () => {
      resetAnimation(animationBottom);
    });

    // 渲染單列數據
    function renderRow(rowIndex) {
      tableContainer.innerHTML = ''; // 清空當前內容

      // 渲染當前列數據（無表頭）
      const row = tableData[rowIndex];
      const rowDiv = document.createElement('div');
      rowDiv.className = 'table-row';
      // 過濾掉空的儲存格，只渲染非空數據
      const filteredRow = row.filter(cell => cell !== '' && cell !== null && cell !== undefined);
      filteredRow.forEach(cell => {
        const cellDiv = document.createElement('div');
        cellDiv.className = 'table-cell';
        const formattedCell = (cell || '').replace(/\n/g, '<br>');
        cellDiv.innerHTML = formattedCell;
        rowDiv.appendChild(cellDiv);
      });
      tableContainer.appendChild(rowDiv);

      // 更新箭頭狀態
      const isFirstRow = rowIndex === 0;
      const isLastRow = rowIndex === tableData.length - 1;
      prevArrowTop.disabled = isFirstRow;
      nextArrowTop.disabled = isLastRow;
      prevArrowBottom.disabled = isFirstRow;
      nextArrowBottom.disabled = isLastRow;
      prevArrowTop.classList.toggle('disabled', isFirstRow);
      nextArrowTop.classList.toggle('disabled', isLastRow);
      prevArrowBottom.classList.toggle('disabled', isFirstRow);
      nextArrowBottom.classList.toggle('disabled', isLastRow);
    }

    // 獲取數據並初始化
    function loadData() {
      tableContainer.innerHTML = '<p>読み込み中…</p>'; // 顯示加載提示
      fetch(appsScriptUrl, { cache: 'no-store' }) // 禁用瀏覽器快取
        .then(response => response.json())
        .then(data => {
          if (!data || data.length === 0) {
            tableContainer.innerHTML = '<p>データが見つかりません。</p>';
            return;
          }

          // 儲存所有數據（無表頭）
          tableData = data;

          if (tableData.length === 0) {
            tableContainer.innerHTML = '<p>データが見つかりません。</p>';
            return;
          }

          // 初始化顯示第一列
          currentRowIndex = 0;
          renderRow(currentRowIndex);
          setupArrowEvents();
        })
        .catch(error => {
          console.error('Error fetching data:', error);
          tableContainer.innerHTML = '<p>データの取得に失敗しました。詳細エラー: ' + error.message + '</p>';
        });
    }

    // 設置箭頭事件
    function setupArrowEvents() {
      // 上方箭頭
      prevArrowTop.addEventListener('click', () => {
        if (currentRowIndex > 0) {
          currentRowIndex--;
          renderRow(currentRowIndex);
          // 觸發從右到左的動畫，隨機選擇圖片
          resetAnimation(animationTop);
          animationTop.style.backgroundImage = `url('${getRandomImage(rightToLeftImages)}')`;
          animationTop.classList.add('move-right-to-left');
        }
      });

      nextArrowTop.addEventListener('click', () => {
        if (currentRowIndex < tableData.length - 1) {
          currentRowIndex++;
          renderRow(currentRowIndex);
          // 觸發從左到右的動畫，隨機選擇圖片
          resetAnimation(animationTop);
          animationTop.style.backgroundImage = `url('${getRandomImage(leftToRightImages)}')`;
          animationTop.classList.add('move-left-to-right');
        }
      });

      // 下方箭頭
      prevArrowBottom.addEventListener('click', () => {
        if (currentRowIndex > 0) {
          currentRowIndex--;
          renderRow(currentRowIndex);
          // 觸發從右到左的動畫，隨機選擇圖片
          resetAnimation(animationBottom);
          animationBottom.style.backgroundImage = `url('${getRandomImage(rightToLeftImages)}')`;
          animationBottom.classList.add('move-right-to-left');
        }
      });

      nextArrowBottom.addEventListener('click', () => {
        if (currentRowIndex < tableData.length - 1) {
          currentRowIndex++;
          renderRow(currentRowIndex);
          // 觸發從左到右的動畫，隨機選擇圖片
          resetAnimation(animationBottom);
          animationBottom.style.backgroundImage = `url('${getRandomImage(leftToRightImages)}')`;
          animationBottom.classList.add('move-left-to-right');
        }
      });
    }

    // 初次加載數據
    loadData();
  </script>
</body>
</html>